{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block title %}
add_info
{% endblock title %}
{% block content %}
 
        <div class='mt-3'>
            <div id='box'></div>
            <form action="" method="POST" id="sForm">
                {% csrf_token %}
                {{form |crispy}}
                <button type="submit" class='btn btn-primary'>Send</button>
            </form>
        </div>
   
{% endblock content %}

{% block scripts %}
    <script>
        console.log('works')
        const form=document.getElementById('sForm')
        console.log(form)

        const name=document.getElementById('div_id_name')
        const description=document.getElementById('div_id_description')

        const csrf=document.getElementsByName('csrfmiddlewaretoken')
        console.log('csrf',csrf)

        const url=""
        const handleAlert=(type,text) =>{
            box.innerHTML += `<div class="alert alert-${type}" role="alert">${text}</div>`
        }
        form.addEventListener('submit',(e)=>{
            e.preventDefault()
            console.log('submitted')

            $.ajax({
                type:'POST',
                url:url,
                data:{
                    'csrfmiddlewaretoken':csrf[0].value,
                    'name':name.value,
                    'description':description.value,
                },
                success:function(response){
                    //console.log(response)
                    const sText=`Success saved! ${response.name}`
                    handleAlert('success',sText)
                    name.value=''
                    description.value=''

                },
                error:function(error){
                    //console.log(error)
                    handleAlert('success','something wrong')
                }
            })
        })

        const box=document.getElementById('box')
        
    </script>
{% endblock scripts %}